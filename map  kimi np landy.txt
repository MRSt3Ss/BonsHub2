--[[
    Enhanced Custom UI Library - Final Merged Version
    
    Deskripsi:
    - [UPDATE 11]: Memperbaiki bug scan pancingan di Dropdown.
    - [UPDATE 11]: Fungsi Refresh (GetPlayerRodNames) sekarang memindai Backpack DAN Character.
    - [UPDATE 11]: Auto Fish sekarang akan berfungsi dengan benar setelah pancingan yang dipegang terdeteksi.
]]

-- ==============================================================================
-- --- KONFIGURASI PLAYER (WAJIB DIISI) ---
-- ==============================================================================
--[[
    PENTING: Isi path ke status bar Anda SEBAGAI STRING (pakai tanda kutip "").
    Script akan otomatis mencari objeknya.
    
    CONTOH:
    local HUNGER_PATH_STRING = "Players.LocalPlayer.PlayerGui.MainUI.Stats.Hunger.ValueObject"
    local THIRST_PATH_STRING = "Players.LocalPlayer.PlayerGui.MainUI.Stats.Thirst.TextLabel"
]]

-- GANTI PATH STRING DI BAWAH INI SESUAI GAME ANDA
local HUNGER_PATH_STRING = "Players.LocalPlayer.Hunger"
local THIRST_PATH_STRING = "Players.LocalPlayer.Thirst"
-- ==============================================================================


-- Membuat tabel utama untuk library
local CustomUI = {}
CustomUI.__index = CustomUI

--==============================================================================
-- Services & Konfigurasi Awal
--==============================================================================

-- Memanggil service Roblox yang dibutuhkan
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Player = game:GetService("Players").LocalPlayer

-- Daftar Kunci Valid (Anda bisa mengupdate daftar ini)
local validKeys = {"1010", "1212"}

-- Sistem Tema (Themes)
local Themes = {
    Default = {
        Name = "Default", Main = Color3.fromRGB(25, 25, 25), Secondary = Color3.fromRGB(35, 35, 35),
        Accent = Color3.fromRGB(0, 85, 255), Text = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(200, 200, 200), Success = Color3.fromRGB(0, 255, 127),
        Warning = Color3.fromRGB(255, 170, 0), Error = Color3.fromRGB(255, 50, 50),
        Section = Color3.fromRGB(45, 45, 45)
    },
    Dark = {
        Name = "Dark", Main = Color3.fromRGB(15, 15, 15), Secondary = Color3.fromRGB(25, 25, 25),
        Accent = Color3.fromRGB(0, 150, 255), Text = Color3.fromRGB(240, 240, 240),
        TextSecondary = Color3.fromRGB(180, 180, 180), Success = Color3.fromRGB(0, 230, 118),
        Warning = Color3.fromRGB(255, 200, 0), Error = Color3.fromRGB(255, 40, 40),
        Section = Color3.fromRGB(35, 35, 35)
    },
    Light = {
        Name = "Light", Main = Color3.fromRGB(245, 245, 245), Secondary = Color3.fromRGB(230, 230, 230),
        Accent = Color3.fromRGB(0, 120, 215), Text = Color3.fromRGB(30, 30, 30),
        TextSecondary = Color3.fromRGB(100, 100, 100), Success = Color3.fromRGB(0, 200, 83),
        Warning = Color3.fromRGB(255, 160, 0), Error = Color3.fromRGB(255, 0, 0),
        Section = Color3.fromRGB(220, 220, 220)
    },
    Purple = {
        Name = "Purple", Main = Color3.fromRGB(30, 25, 40), Secondary = Color3.fromRGB(40, 35, 50),
        Accent = Color3.fromRGB(170, 0, 255), Text = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(200, 200, 200), Success = Color3.fromRGB(0, 255, 170),
        Warning = Color3.fromRGB(255, 200, 0), Error = Color3.fromRGB(255, 50, 100),
        Section = Color3.fromRGB(50, 45, 60)
    }
}

local CurrentTheme = Themes.Default
local UIEnabled = true
local ToggleUIKeybind = "RightControl"
local CoreGui = game:GetService("CoreGui") or game.Players.LocalPlayer:WaitForChild("PlayerGui")

--==============================================================================
-- Remote Events
--==============================================================================
-- Hati-hati jika game mengupdate nama-nama ini
local CheckoutFunction = ReplicatedStorage:WaitForChild("CheckoutFunction")
local EatFoodEvent = ReplicatedStorage:WaitForChild("EatFoodEvent")

--==============================================================================
-- Fungsi Bantuan (Utility Functions)
--==============================================================================

local function CreateInstance(className, properties)
    local instance = Instance.new(className)
    for prop, value in pairs(properties) do
        if prop ~= "Parent" then instance[prop] = value end
    end
    if properties.Parent then instance.Parent = properties.Parent end
    return instance
end

local function ApplyCornerRadius(instance, radius)
    local corner = instance:FindFirstChildOfClass("UICorner") or CreateInstance("UICorner", { Parent = instance })
    corner.CornerRadius = UDim.new(0, radius)
    return corner
end

local function ApplyStroke(instance, color, thickness)
    local stroke = instance:FindFirstChildOfClass("UIStroke") or CreateInstance("UIStroke", { Parent = instance })
    stroke.Color = color
    stroke.Thickness = thickness
    return stroke
end

local function SmoothTween(instance, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(duration or 0.3, easingStyle or Enum.EasingStyle.Quint, easingDirection or Enum.EasingDirection.Out)
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

--==============================================================================
-- Sistem Notifikasi
--==============================================================================

function CustomUI:Notify(options)
    options = options or {}
    local notificationGui = CreateInstance("ScreenGui", { Name = "Notification", ZIndexBehavior = Enum.ZIndexBehavior.Sibling, DisplayOrder = 999, Parent = CoreGui })
    local mainFrame = CreateInstance("Frame", { Name = "MainFrame", Size = UDim2.new(0, 300, 0, 80), Position = UDim2.new(1, 20, 0, 20), BackgroundColor3 = CurrentTheme.Secondary, Parent = notificationGui })
    ApplyCornerRadius(mainFrame, 8); ApplyStroke(mainFrame, CurrentTheme.Main, 1)
    CreateInstance("TextLabel", { Name = "Title", Size = UDim2.new(1, -30, 0, 20), Position = UDim2.new(0, 15, 0, 10), BackgroundTransparency = 1, Text = options.Title or "Notification", TextColor3 = CurrentTheme.Text, TextSize = 16, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.GothamSemibold, Parent = mainFrame })
    CreateInstance("TextLabel", { Name = "Content", Size = UDim2.new(1, -30, 1, -40), Position = UDim2.new(0, 15, 0, 35), BackgroundTransparency = 1, Text = options.Content or "This is a notification", TextColor3 = CurrentTheme.TextSecondary, TextSize = 14, TextWrapped = true, TextXAlignment = Enum.TextXAlignment.Left, TextYAlignment = Enum.TextYAlignment.Top, Font = Enum.Font.Gotham, Parent = mainFrame })
    
    SmoothTween(mainFrame, {Position = UDim2.new(1, -320, 0, 20)}, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    task.delay(options.Duration or 5, function()
        if not mainFrame or not mainFrame.Parent then return end
        SmoothTween(mainFrame, {Position = UDim2.new(1, 20, 0, 20)}, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        task.wait(0.5); notificationGui:Destroy()
    end)
    return notificationGui
end

--==============================================================================
-- Pembuatan Jendela Utama (Window)
--==============================================================================

function CustomUI:CreateWindow(options)
    options = options or {}
    local window = {}
    local screenGui = CreateInstance("ScreenGui", { Name = "CustomUI", ZIndexBehavior = Enum.ZIndexBehavior.Sibling, Enabled = false })
    
    local mainFrame = CreateInstance("Frame", { Name = "MainFrame", Size = UDim2.new(0, 500, 0, 500), Position = UDim2.new(0.5, -250, 0.5, -250), BackgroundColor3 = CurrentTheme.Main, Parent = screenGui, ClipsDescendants = true })
    ApplyCornerRadius(mainFrame, 12); local mainStroke = ApplyStroke(mainFrame, CurrentTheme.Accent, 2)
    
    local titleBar = CreateInstance("Frame", { Name = "TitleBar", Size = UDim2.new(1, 0, 0, 40), BackgroundColor3 = CurrentTheme.Secondary, Parent = mainFrame })
    local titleLabel = CreateInstance("TextLabel", { Name = "Title", Size = UDim2.new(1, -60, 1, 0), Position = UDim2.new(0, 15, 0, 0), BackgroundTransparency = 1, Text = options.Name or "Custom UI", TextColor3 = CurrentTheme.Text, TextSize = 18, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.GothamBold, Parent = titleBar })
    local closeButton = CreateInstance("TextButton", { Name = "CloseButton", Size = UDim2.new(0, 30, 0, 30), Position = UDim2.new(1, -40, 0.5, -15), BackgroundColor3 = CurrentTheme.Error, Text = "Ã—", TextColor3 = CurrentTheme.Text, TextSize = 20, Font = Enum.Font.GothamBold, Parent = titleBar })
    ApplyCornerRadius(closeButton, 6)
    
    local tabContainer = CreateInstance("Frame", { Name = "TabContainer", Size = UDim2.new(1, -20, 0, 35), Position = UDim2.new(0, 10, 0, 45), BackgroundTransparency = 1, Parent = mainFrame })
    CreateInstance("UIListLayout", { FillDirection = Enum.FillDirection.Horizontal, Padding = UDim.new(0, 5), Parent = tabContainer })
    
    local contentFrame = CreateInstance("Frame", { Name = "Content", Size = UDim2.new(1, -20, 1, -90), Position = UDim2.new(0, 10, 0, 85), BackgroundTransparency = 1, Parent = mainFrame, ClipsDescendants = true })
    
    -- Dragging Logic
    local dragging, dragStart, startPos
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true; dragStart = input.Position; startPos = mainFrame.Position
            local conn; conn = input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false; conn:Disconnect() end end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then local delta = input.Position - dragStart; mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)
    
    -- Button Animation Logic
    local function SetupButtonAnimation(button, normalColor, hoverColor)
        button.MouseEnter:Connect(function() SmoothTween(button, {BackgroundColor3 = hoverColor}, 0.2) end)
        button.MouseLeave:Connect(function() SmoothTween(button, {BackgroundColor3 = normalColor}, 0.2) end)
    end
    SetupButtonAnimation(closeButton, CurrentTheme.Error, Color3.fromRGB(255, 80, 80))
    closeButton.MouseButton1Click:Connect(function()
        SmoothTween(mainFrame, {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)}, 0.3)
        task.wait(0.3); screenGui:Destroy()
    end)
    
    -- Keybind Logic
    local function SetupKeybind()
        UserInputService.InputBegan:Connect(function(input, gameProcessed)
            if gameProcessed then return end
            if input.KeyCode.Name == ToggleUIKeybind then UIEnabled = not UIEnabled; mainFrame.Visible = UIEnabled end
        end)
    end
    
    function window:CreateTab(name, icon)
        local tab = {}
        local tabButton = CreateInstance("TextButton", { Name = name .. "Tab", Size = UDim2.new(0, 80, 1, 0), BackgroundColor3 = CurrentTheme.Secondary, Text = name, TextColor3 = CurrentTheme.TextSecondary, TextSize = 14, Font = Enum.Font.Gotham, Parent = tabContainer })
        ApplyCornerRadius(tabButton, 6)
        local tabContent = CreateInstance("ScrollingFrame", { Name = name .. "Content", Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1, BorderSizePixel = 0, ScrollBarImageColor3 = CurrentTheme.Accent, ScrollBarThickness = 3, CanvasSize = UDim2.new(), AutomaticCanvasSize = Enum.AutomaticSize.Y, Visible = false, Parent = contentFrame })
        CreateInstance("UIListLayout", { Padding = UDim.new(0, 15), Parent = tabContent })
        CreateInstance("UIPadding", { PaddingTop = UDim.new(0, 10), PaddingLeft = UDim.new(0, 5), PaddingRight = UDim.new(0, 5), Parent = tabContent })
        
        local function ActivateTab()
            for _, child in pairs(tabContainer:GetChildren()) do if child:IsA("TextButton") then SmoothTween(child, {BackgroundColor3 = CurrentTheme.Secondary, TextColor3 = CurrentTheme.TextSecondary}, 0.2) end end
            for _, child in pairs(contentFrame:GetChildren()) do if child:IsA("ScrollingFrame") then child.Visible = false end end
            SmoothTween(tabButton, {BackgroundColor3 = CurrentTheme.Accent, TextColor3 = CurrentTheme.Text}, 0.2)
            tabContent.Visible = true
        end
        tabButton.MouseButton1Click:Connect(ActivateTab)
        if #tabContainer:GetChildren() == 1 then ActivateTab() end
        
        function tab:CreateSection(title)
            local sectionFrame = CreateInstance("Frame", { Name = "SectionFrame", Size = UDim2.new(1, 0, 0, 30), BackgroundColor3 = CurrentTheme.Section, Parent = tabContent })
            ApplyCornerRadius(sectionFrame, 6); ApplyStroke(sectionFrame, CurrentTheme.Accent, 1)
            CreateInstance("TextLabel", { Name = "SectionLabel", Size = UDim2.new(1, -20, 1, 0), Position = UDim2.new(0, 10, 0, 0), BackgroundTransparency = 1, Text = title or "Section", TextColor3 = CurrentTheme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.GothamSemibold, Parent = sectionFrame })
            return sectionFrame
        end
        
        function tab:CreateButton(options)
            local buttonFrame = CreateInstance("Frame", { Name = "ButtonFrame", Size = UDim2.new(1, 0, 0, 40), BackgroundColor3 = CurrentTheme.Secondary, Parent = tabContent })
            ApplyCornerRadius(buttonFrame, 8)
            local button = CreateInstance("TextButton", { Name = "Button", Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1, Text = options.Name or "Button", TextColor3 = CurrentTheme.Text, TextSize = 14, Font = Enum.Font.Gotham, Parent = buttonFrame })
            button.MouseEnter:Connect(function() SmoothTween(buttonFrame, {BackgroundColor3 = CurrentTheme.Accent}, 0.2) end)
            button.MouseLeave:Connect(function() SmoothTween(buttonFrame, {BackgroundColor3 = CurrentTheme.Secondary}, 0.2) end)
            if options.Callback then button.MouseButton1Click:Connect(options.Callback) end
            return button
        end
        
        function tab:CreateToggle(options)
            local isToggled = options.CurrentValue or false
            local toggleFrame = CreateInstance("Frame", { Name = "ToggleFrame", Size = UDim2.new(1, 0, 0, 40), BackgroundColor3 = CurrentTheme.Secondary, Parent = tabContent })
            ApplyCornerRadius(toggleFrame, 8)
            local clickableArea = CreateInstance("TextButton", { Name = "ClickableArea", Size = UDim2.new(1,0,1,0), BackgroundTransparency = 1, Text="", Parent = toggleFrame, ZIndex = 2 })
            local label = CreateInstance("TextLabel", { Name = "Label", Size = UDim2.new(0.7, 0, 1, 0), Position = UDim2.new(0, 10, 0, 0), BackgroundTransparency = 1, Text = options.Name or "Toggle", TextColor3 = CurrentTheme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.Gotham, Parent = toggleFrame })
            local toggleContainer = CreateInstance("Frame", { Name = "ToggleContainer", Size = UDim2.new(0, 40, 0, 20), Position = UDim2.new(1, -50, 0.5, -10), BackgroundColor3 = Color3.fromRGB(80, 80, 80), Parent = toggleFrame })
            ApplyCornerRadius(toggleContainer, 10)
            local toggleKnob = CreateInstance("Frame", { Name = "ToggleKnob", Size = UDim2.new(0, 16, 0, 16), Position = UDim2.new(0, 2, 0.5, -8), BackgroundColor3 = CurrentTheme.Text, Parent = toggleContainer })
            ApplyCornerRadius(toggleKnob, 8)
            local function UpdateToggle()
                local knobPos = isToggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
                local bgColor = isToggled and CurrentTheme.Accent or Color3.fromRGB(80, 80, 80)
                SmoothTween(toggleContainer, {BackgroundColor3 = bgColor}, 0.2); SmoothTween(toggleKnob, {Position = knobPos}, 0.2)
            end
            local function Toggle() isToggled = not isToggled; UpdateToggle(); if options.Callback then pcall(options.Callback, isToggled) end end
            clickableArea.MouseButton1Click:Connect(Toggle); UpdateToggle()
            local toggleObject = {}; function toggleObject:Set(v) isToggled = v; UpdateToggle() end; function toggleObject:Get() return isToggled end
            return toggleObject
        end
        
        function tab:CreateSlider(options)
            local sliderFrame = CreateInstance("Frame", { Name = "SliderFrame", Size = UDim2.new(1, 0, 0, 70), BackgroundColor3 = CurrentTheme.Secondary, Parent = tabContent })
            ApplyCornerRadius(sliderFrame, 8)
            local label = CreateInstance("TextLabel", { Name = "Label", Size = UDim2.new(1, -80, 0, 20), Position = UDim2.new(0, 10, 0, 5), BackgroundTransparency = 1, Text = options.Name or "Slider", TextColor3 = CurrentTheme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.Gotham, Parent = sliderFrame })
            local valueLabel = CreateInstance("TextLabel", { Name = "ValueLabel", Size = UDim2.new(0, 60, 0, 20), Position = UDim2.new(1, -70, 0, 5), BackgroundTransparency = 1, TextColor3 = CurrentTheme.TextSecondary, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Right, Font = Enum.Font.Gotham, Parent = sliderFrame })
            local sliderTrack = CreateInstance("Frame", { Name = "SliderTrack", Size = UDim2.new(1, -20, 0, 6), Position = UDim2.new(0, 10, 0, 35), BackgroundColor3 = Color3.fromRGB(60, 60, 60), Parent = sliderFrame })
            ApplyCornerRadius(sliderTrack, 3)
            local sliderFill = CreateInstance("Frame", { Name = "SliderFill", Size = UDim2.new(0.5, 0, 1, 0), BackgroundColor3 = CurrentTheme.Accent, Parent = sliderTrack })
            ApplyCornerRadius(sliderFill, 3)
            local sliderButton = CreateInstance("TextButton", { Name = "SliderButton", Size = UDim2.new(0, 16, 0, 16), Position = UDim2.new(0.5, -8, 0.5, -8), BackgroundColor3 = CurrentTheme.Text, Text = "", AutoButtonColor = false, Parent = sliderTrack })
            ApplyCornerRadius(sliderButton, 8)
            local range, increment, currentValue = options.Range or {0, 100}, options.Increment or 1, options.CurrentValue or 50
            local function UpdateSlider(value)
                currentValue = math.clamp(math.floor(value / increment + 0.5) * increment, range[1], range[2])
                local percentage = (currentValue - range[1]) / (range[2] - range[1])
                SmoothTween(sliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.05); SmoothTween(sliderButton, {Position = UDim2.new(percentage, -8, 0.5, -8)}, 0.05)
                valueLabel.Text = tostring(currentValue) .. (options.Suffix or "")
                if options.Callback then pcall(options.Callback, currentValue) end
            end
            local dragging = false
            local function onDrag(input)
                local relativeX = input.Position.X - sliderTrack.AbsolutePosition.X
                local percentage = math.clamp(relativeX / sliderTrack.AbsoluteSize.X, 0, 1)
                local value = range[1] + (range[2] - range[1]) * percentage; UpdateSlider(value)
            end
            local trackButton = CreateInstance("TextButton", {Size=UDim2.new(1,0,1,0), BackgroundTransparency=1, Text="", Parent=sliderTrack})
            trackButton.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; onDrag(input) end end)
            sliderButton.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end end)
            UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
            UserInputService.InputChanged:Connect(function(input) if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then onDrag(input) end end)
            UpdateSlider(currentValue)
            local sliderObject = {}; function sliderObject:Set(value) UpdateSlider(value) end; function sliderObject:Get() return currentValue end
            return sliderObject
        end
        
        -- [UPDATE 7] Fungsi baru untuk Textbox
        function tab:CreateTextbox(options)
            local textboxFrame = CreateInstance("Frame", { Name = "TextboxFrame", Size = UDim2.new(1, 0, 0, 70), BackgroundColor3 = CurrentTheme.Secondary, Parent = tabContent })
            ApplyCornerRadius(textboxFrame, 8)
            
            local label = CreateInstance("TextLabel", {
                Name = "Label", Size = UDim2.new(1, -20, 0, 20), Position = UDim2.new(0, 10, 0, 5),
                BackgroundTransparency = 1, Text = options.Name or "Textbox", TextColor3 = CurrentTheme.Text,
                TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.Gotham,
                Parent = textboxFrame
            })
            
            local textboxInput = CreateInstance("TextBox", {
                Name = "Input", Size = UDim2.new(1, -20, 0, 35), Position = UDim2.new(0, 10, 0, 30),
                BackgroundColor3 = CurrentTheme.Main, Text = options.Default or "",
                PlaceholderText = options.Placeholder or "...", TextColor3 = CurrentTheme.Text,
                Font = Enum.Font.Gotham, ClearTextOnFocus = false,
                Parent = textboxFrame
            })
            ApplyCornerRadius(textboxInput, 6)
            
            -- Filter input jika IsNumber = true
            if options.IsNumber then
                textboxInput:GetPropertyChangedSignal("Text"):Connect(function()
                    textboxInput.Text = textboxInput.Text:gsub("[^%d]", "") -- Hanya izinkan angka
                end)
            end
            
            local textboxObject = {}
            function textboxObject:Get() return textboxInput.Text end
            function textboxObject:Set(text) textboxInput.Text = tostring(text) end
            
            -- Callback saat 'Enter' ditekan
            if options.Callback then
                textboxInput.FocusLost:Connect(function(enterPressed)
                    if enterPressed then
                        pcall(options.Callback, textboxInput.Text)
                    end
                end)
            end
            
            return textboxObject
        end
        
        -- [UPDATE 10] Fungsi baru untuk Dropdown
        function tab:CreateDropdown(options)
            local dropdownFrame = CreateInstance("Frame", {
                Name = options.Name or "DropdownFrame",
                Size = UDim2.new(1, 0, 0, 40),
                BackgroundColor3 = CurrentTheme.Secondary,
                Parent = tabContent,
                ClipsDescendants = true
            })
            ApplyCornerRadius(dropdownFrame, 8)
            
            local selectedValue = options.Default or "Pilih..."
            local isOpen = false
            
            local mainButton = CreateInstance("TextButton", {
                Name = "MainButton",
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = selectedValue .. " â–¼",
                TextColor3 = CurrentTheme.Text,
                TextSize = 14,
                Font = Enum.Font.Gotham,
                ZIndex = 2,
                Parent = dropdownFrame
            })
            
            local optionsList = CreateInstance("ScrollingFrame", {
                Name = "OptionsList",
                Size = UDim2.new(1, 0, 0, 120),
                Position = UDim2.new(0, 0, 1, 0),
                BackgroundColor3 = CurrentTheme.Main,
                BorderSizePixel = 0,
                ZIndex = 1,
                Visible = false,
                ScrollBarImageColor3 = CurrentTheme.Accent,
                ScrollBarThickness = 4,
                Parent = dropdownFrame
            })
            ApplyCornerRadius(optionsList, 6)
            CreateInstance("UIListLayout", {
                Padding = UDim.new(0, 2),
                Parent = optionsList
            })
            CreateInstance("UIPadding", {
                PaddingTop = UDim.new(0, 5), PaddingBottom = UDim.new(0, 5),
                PaddingLeft = UDim.new(0, 5), PaddingRight = UDim.new(0, 5),
                Parent = optionsList
            })
            
            local function ToggleDropdown()
                isOpen = not isOpen
                if isOpen then
                    dropdownFrame.ClipsDescendants = false
                    dropdownFrame.Size = UDim2.new(1, 0, 0, 160) -- 40 (main) + 120 (list)
                    mainButton.Text = selectedValue .. " â–²"
                    optionsList.Visible = true
                else
                    dropdownFrame.ClipsDescendants = true
                    dropdownFrame.Size = UDim2.new(1, 0, 0, 40)
                    mainButton.Text = selectedValue .. " â–¼"
                    optionsList.Visible = false
                end
            end
            
            mainButton.MouseButton1Click:Connect(ToggleDropdown)
            
            local dropdownObject = {}
            
            function dropdownObject:SetOptions(optionsTable)
                -- Hapus opsi lama
                for _, v in pairs(optionsList:GetChildren()) do
                    if v:IsA("TextButton") then v:Destroy() end
                end
                
                if #optionsTable == 0 then
                    optionsTable = {"Tidak ada pancingan ditemukan"}
                end
                
                -- Tambah opsi baru
                for _, optionName in ipairs(optionsTable) do
                    local optionButton = CreateInstance("TextButton", {
                        Name = optionName,
                        Size = UDim2.new(1, 0, 0, 30),
                        BackgroundColor3 = CurrentTheme.Main,
                        BackgroundTransparency = 0.2,
                        Text = "  " .. optionName,
                        TextColor3 = CurrentTheme.TextSecondary,
                        TextSize = 14,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        Font = Enum.Font.Gotham,
                        Parent = optionsList
                    })
                    
                    optionButton.MouseEnter:Connect(function() optionButton.BackgroundColor3 = CurrentTheme.Accent end)
                    optionButton.MouseLeave:Connect(function() optionButton.BackgroundColor3 = CurrentTheme.Main end)
                    
                    optionButton.MouseButton1Click:Connect(function()
                        selectedValue = optionName
                        if options.Callback then pcall(options.Callback, selectedValue) end
                        ToggleDropdown() -- Tutup dropdown
                    end)
                end
                
                -- Set nilai default ke opsi pertama jika ada
                if #optionsTable > 0 then
                    selectedValue = optionsTable[1]
                    mainButton.Text = selectedValue .. " â–¼"
                end
            end
            
            function dropdownObject:Get() return selectedValue end
            function dropdownObject:Set(value)
                selectedValue = tostring(value)
                mainButton.Text = selectedValue .. (isOpen and " â–²" or " â–¼")
            end
            
            -- Isi dengan opsi default
            dropdownObject:SetOptions(options.Options or {"Default Option"})
            dropdownObject:Set(options.Default or "Pilih...")
            
            return dropdownObject
        end
        
        function tab:CreateKeybind(options)
            local keybindFrame = CreateInstance("Frame", { Name = "KeybindFrame", Size = UDim2.new(1, 0, 0, 40), BackgroundColor3 = CurrentTheme.Secondary, Parent = tabContent })
            ApplyCornerRadius(keybindFrame, 8)
            local label = CreateInstance("TextLabel", { Name = "Label", Size = UDim2.new(0.6, 0, 1, 0), Position = UDim2.new(0, 10, 0, 0), BackgroundTransparency = 1, Text = options.Name or "Keybind", TextColor3 = CurrentTheme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.Gotham, Parent = keybindFrame })
            local keybindButton = CreateInstance("TextButton", { Name = "KeybindButton", Size = UDim2.new(0, 100, 0, 25), Position = UDim2.new(1, -110, 0.5, -12.5), BackgroundColor3 = CurrentTheme.Accent, Text = options.CurrentKeybind or "None", TextColor3 = CurrentTheme.Text, TextSize = 12, Font = Enum.Font.Gotham, Parent = keybindFrame })
            ApplyCornerRadius(keybindButton, 6)
            local listening = false
            keybindButton.MouseButton1Click:Connect(function()
                if listening then return end
                listening = true; keybindButton.Text = "..."; keybindButton.BackgroundColor3 = CurrentTheme.Warning
                local connection; connection = UserInputService.InputBegan:Connect(function(input, gp)
                    if not gp and input.UserInputType == Enum.UserInputType.Keyboard then
                        local key = input.KeyCode.Name; keybindButton.Text = key; keybindButton.BackgroundColor3 = CurrentTheme.Accent
                        listening = false; connection:Disconnect()
                        if options.Callback then pcall(options.Callback, key) end
                    end
                end)
            end)
            return keybindButton
        end
        
        function tab:CreateLabel(text) return CreateInstance("TextLabel", { Name = "Label", Size = UDim2.new(1, 0, 0, 25), BackgroundTransparency = 1, Text = text or "Label", TextColor3 = CurrentTheme.TextSecondary, TextSize = 13, TextXAlignment = Enum.TextXAlignment.Left, Font = Enum.Font.Gotham, Parent = tabContent }) end
        function tab:CreateDivider() return CreateInstance("Frame", { Name = "DividerFrame", Size = UDim2.new(1, 0, 0, 1), BackgroundColor3 = CurrentTheme.TextSecondary, BackgroundTransparency = 0.7, Parent = tabContent }) end
        return tab
    end
    
    function window:ChangeTheme(themeName)
        if Themes[themeName] then
            CurrentTheme = Themes[themeName]
            SmoothTween(mainFrame, {BackgroundColor3 = CurrentTheme.Main}, 0.3)
            SmoothTween(titleBar, {BackgroundColor3 = CurrentTheme.Secondary}, 0.3)
            titleLabel.TextColor3 = CurrentTheme.Text
            ApplyStroke(mainFrame, CurrentTheme.Accent, 2)
            CustomUI:Notify({ Title = "Theme Changed", Content = "Switched to " .. themeName, Duration = 2 })
        end
    end
    
    function window:SetToggleKeybind(key)
        ToggleUIKeybind = key
        CustomUI:Notify({ Title = "Keybind Updated", Content = "Toggle UI keybind set to: " .. key, Duration = 3 })
    end
    
    function window:Show()
        screenGui.Parent = CoreGui
        screenGui.Enabled = true
        mainFrame.Visible = true
        mainFrame.Size = UDim2.new(0,0,0,0)
        SmoothTween(mainFrame, {Size = UDim2.new(0, 500, 0, 500), Position = UDim2.new(0.5, -250, 0.5, -250)}, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    end

    SetupKeybind()
    return window, screenGui
end

--==============================================================================
-- Sistem Kunci (Key System)
--==============================================================================

local function CreateKeySystem(onSuccess)
    local keyGui = CreateInstance("ScreenGui", {Name = "KeySystem", ZIndexBehavior = Enum.ZIndexBehavior.Sibling, DisplayOrder = 1000, Parent = CoreGui})
    local main = CreateInstance("Frame", {Name="Main", Size=UDim2.new(0,350,0,180), Position=UDim2.new(0.5,-175,0.5,-90), BackgroundColor3=CurrentTheme.Main, Parent=keyGui})
    ApplyCornerRadius(main, 8); ApplyStroke(main, CurrentTheme.Accent, 1)
    CreateInstance("TextLabel", {Name="Title", Size=UDim2.new(1,0,0,40), BackgroundTransparency=1, Text="Sistem Kunci", TextColor3=CurrentTheme.Text, TextSize=20, Font=Enum.Font.GothamBold, Parent=main})
    local input = CreateInstance("TextBox", {Name="Input", Size=UDim2.new(1,-40,0,40), Position=UDim2.new(0.5,0,0,50), AnchorPoint=Vector2.new(0.5,0), BackgroundColor3=CurrentTheme.Secondary, Text="", PlaceholderText="Masukkan kunci...", TextColor3=CurrentTheme.Text, Font=Enum.Font.Gotham, Parent=main})
    ApplyCornerRadius(input, 6)
    local submit = CreateInstance("TextButton", {Name="Submit", Size=UDim2.new(1,-40,0,40), Position=UDim2.new(0.5,0,0,100), AnchorPoint=Vector2.new(0.5,0), BackgroundColor3=CurrentTheme.Accent, Text="Masuk", TextColor3=CurrentTheme.Text, Font=Enum.Font.GothamSemibold, Parent=main})
    ApplyCornerRadius(submit, 6)

    submit.MouseButton1Click:Connect(function()
        if table.find(validKeys, input.Text) then
            SmoothTween(main, {BackgroundTransparency=1, Size=UDim2.new()}, 0.3)
            task.wait(0.3); keyGui:Destroy()
            pcall(onSuccess)
        else
            CustomUI:Notify({Title="Error", Content="Kunci yang dimasukkan salah.", Duration=3})
            local originalPos = main.Position
            local sequence = {UDim2.new(0,10,0,0), UDim2.new(0,-10,0,0), UDim2.new(0,0,0,0)}
            for i, offset in ipairs(sequence) do SmoothTween(main, {Position = originalPos + offset}, 0.05); task.wait(0.05) end
        end
    end)
end

--==============================================================================
-- Layar Pemuatan (Loading Screen)
--==============================================================================

local function CreateLoadingScreen()
    local loadingGui = CreateInstance("ScreenGui", {Name="LoadingScreen", ZIndexBehavior=Enum.ZIndexBehavior.Sibling, DisplayOrder=1001, Parent = CoreGui})
    local bg = CreateInstance("Frame", {Size=UDim2.new(1,0,1,0), BackgroundColor3=Color3.new(0,0,0), BackgroundTransparency=0.5, Parent=loadingGui})
    CreateInstance("TextLabel", {Size=UDim2.new(1,0,1,0), BackgroundTransparency=1, Text="Memuat...", TextColor3=Color3.new(1,1,1), TextSize=30, Font=Enum.Font.GothamBold, Parent=bg})
    return loadingGui
end

--==============================================================================
-- Eksekusi Utama
--==============================================================================

-- Tampilkan Loading Screen
local loadingScreen = CreateLoadingScreen()
task.wait(2) -- Simulasi waktu loading
SmoothTween(loadingScreen:FindFirstChild("Frame"), {BackgroundTransparency=1}, 0.5)
task.wait(0.5)
loadingScreen:Destroy()

-- Buat Window UI utama
local Window, WindowGui = CustomUI:CreateWindow({ Name = "Fish It Auto" }) -- Mengganti nama window

-- Tampilkan Sistem Kunci, dan jika berhasil, tampilkan UI
CreateKeySystem(function()
    Window:Show()
    CustomUI:Notify({
        Title = "Selamat Datang!",
        Content = "UI Auto Fish berhasil dimuat.\nTekan RightControl untuk Buka/Tutup UI",
        Duration = 5
    })
end)

--==============================================================================
-- IMPLEMENTASI AUTO FISH (UPDATE 11)
--==============================================================================

-- Variabel untuk mengontrol loop
local AutoFishEnabled = false
local MasterFishingLoopActive = false -- Untuk menandai loop sedang berjalan
local IsEatingOrDrinking = false -- Variabel status global
local BypassDelaySlider 
local CooldownPerRodSlider 
local InstantCatchToggle 
local RodDropdown -- [FIX 10] Variabel untuk Dropdown

-- [FIX 11] Fungsi untuk scan pancingan di Backpack DAN Character
local function GetPlayerRodNames()
    local rodNames = {}
    local rodCache = {} -- Untuk mencegah duplikat
    
    local function CheckAndAddRod(tool)
        if tool and tool:IsA("Tool") and not rodCache[tool.Name] then
            if tool:FindFirstChild("Mechanics") and tool.Mechanics:FindFirstChild("Remotes") and tool.Mechanics.Remotes:FindFirstChild("CastEvent") then
                table.insert(rodNames, tool.Name)
                rodCache[tool.Name] = true
            end
        end
    end

    -- 1. Scan Backpack
    if Player.Backpack then
        for _, tool in ipairs(Player.Backpack:GetChildren()) do
            CheckAndAddRod(tool)
        end
    end
    
    -- 2. Scan Character (yang sedang dipegang)
    if Player.Character then
        local currentTool = Player.Character:FindFirstChildOfClass("Tool")
        CheckAndAddRod(currentTool)
    end
    
    return rodNames
end


-- [FIX 10] Rombakan Loop Mancing (Mengunci 1 Pancingan)
local function StartMasterFishingLoop()
    if MasterFishingLoopActive then return end 
    MasterFishingLoopActive = true
    
    task.spawn(function()
        while AutoFishEnabled do
            while IsEatingOrDrinking do task.wait(1) end
            
            local Humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
            if not Humanoid or Humanoid.Health <= 0 then
                MasterFishingLoopActive = false
                break 
            end
            
            -- [FIX 10] Dapatkan nama pancingan dari Dropdown
            local selectedRodName = RodDropdown:Get()
            if not selectedRodName or selectedRodName == "Pilih Pancingan..." or selectedRodName == "Tidak ada pancingan ditemukan" then
                CustomUI:Notify({Title="Error", Content="Pilih pancingan yang valid dulu!", Duration=3})
                StopMasterFishingLoop() -- Matikan toggle
                break
            end
            
            -- [FIX 10] Cari pancingan yang dipilih
            local rod = Player.Backpack:FindFirstChild(selectedRodName) or Player.Character:FindFirstChild(selectedRodName)
            
            if not rod then
                CustomUI:Notify({Title="Error", Content="Pancingan '"..selectedRodName.."' tidak ditemukan! Refresh?", Duration=3})
                StopMasterFishingLoop()
                break
            end
            
            -- [FIX 10] Equip pancingan jika ada di backpack
            local equippedRod = nil
            if rod.Parent == Player.Backpack then
                Humanoid:EquipTool(rod)
                task.wait(0.5) 
                equippedRod = Player.Character:FindFirstChild(rod.Name)
            else
                equippedRod = rod -- Sudah dipegang
            end

            if not equippedRod then
                warn("Gagal equip atau menemukan " .. rod.Name)
                task.wait(1)
                continue -- Ulangi loop, coba cari lagi
            end

            local Remotes = equippedRod:FindFirstChild("Mechanics") and equippedRod.Mechanics:FindFirstChild("Remotes")
            local CastEvent = Remotes and Remotes:FindFirstChild("CastEvent")
            local MiniGameEvent = Remotes and Remotes:FindFirstChild("MiniGame")
            
            if not (CastEvent and MiniGameEvent) then
                warn("Pancingan " .. equippedRod.Name .. " tidak memiliki remote event lengkap. Di-skip.")
                StopMasterFishingLoop()
                break
            end
            
            -- [FIX 10] Loop ini sekarang akan MENGGUNAKAN PANCINGAN YANG SAMA terus menerus
            if InstantCatchToggle:Get() then
                -- ==================
                -- MODE INSTAN (BERESIKO)
                -- ==================
                pcall(function()
                    CastEvent:FireServer(true)
                    MiniGameEvent:FireServer(true)
                    CastEvent:FireServer(false, 100)
                    task.wait(CooldownPerRodSlider:Get()) 
                end)
            else
                -- ==================
                -- MODE STABIL (BYPASS)
                -- ==================
                pcall(function()
                    local bypassDelay = BypassDelaySlider:Get()
                    local cooldown = CooldownPerRodSlider:Get()
                    
                    CastEvent:FireServer(true)
                    task.wait(bypassDelay)
                    
                    if not AutoFishEnabled or IsEatingOrDrinking then return end
                    
                    MiniGameEvent:FireServer(true)
                    task.wait(bypassDelay)
                    
                    if not AutoFishEnabled or IsEatingOrDrinking then return end

                    CastEvent:FireServer(false, 100)
                    task.wait(cooldown)
                end)
            end
            
            task.wait(0.1) -- Jeda singkat sebelum mancing lagi dengan rod yang sama
        end
        
        MasterFishingLoopActive = false 
    end)
end

-- Fungsi untuk menghentikan semua loop
local function StopMasterFishingLoop()
    AutoFishEnabled = false
end

--==============================================================================
-- IMPLEMENTASI FITUR BARU (UPDATE 9)
--==============================================================================

-- --- Variabel Kontrol ---
local AutoEatEnabled = false
local AntiAfkEnabled = false
-- IsEatingOrDrinking ada di bagian Auto Fish

-- --- Auto Eat/Drink ---
local AutoEatCheckIntervalTextbox -- [FIX 7] Ganti dari slider ke textbox
local AutoEatThresholdSlider -- [FIX 7] Slider baru untuk batas
local AutoEatAmountSlider

-- [FIX 8] Helper function (diperbaiki) untuk mendapatkan nilai status dari STRING PATH
local function GetPlayerStatValue(pathString)
    if not pathString or pathString == "" then return nil end
    
    local obj = nil
    local success, err = pcall(function()
        local parts = {}
        for part in pathString:gmatch("([^%.:]+)") do 
            table.insert(parts, part) 
        end
        
        local current = game
        if parts[1]:lower() == "game" then
            table.remove(parts, 1) -- Hapus "game" jika ada
        elseif parts[1]:lower() == "workspace" then
            current = workspace
            table.remove(parts, 1)
        elseif parts[1]:lower() == "players" and parts[2]:lower() == "localplayer" then
            current = Player 
            table.remove(parts, 1)
            table.remove(parts, 1)
        end

        for _, partName in ipairs(parts) do
            current = current:WaitForChild(partName, 1) -- Tunggu maks 1 detik per part
            if not current then
                return
            end
        end
        obj = current
    end)

    if not success or not obj then
        -- Kirim notifikasi HANYA SEKALI agar tidak spam
        if not _G.PathErrorNotified then
            CustomUI:Notify({Title="Auto-Eat Error", Content="Gagal menemukan path. Cek KONFIGURASI di atas script.", Duration=10})
            warn("Auto-Eat Error: Gagal menemukan path: " .. pathString .. ". Error: " .. tostring(err))
            _G.PathErrorNotified = true
        end
        return nil
    end

    _G.PathErrorNotified = false -- Reset error jika berhasil
    
    -- Path ditemukan, sekarang ambil nilainya
    if obj:IsA("ValueBase") then
        return obj.Value 
    elseif obj:IsA("TextLabel") or obj:IsA("TextBox") then
        return tonumber(obj.Text:match("%d+"))
    elseif obj:IsA("Frame") or obj:IsA("ImageLabel") then
        return math.floor(obj.Size.X.Scale * 100)
    end
    
    warn("Auto-Eat Warning: Path " .. pathString .. " bukan objek yang bisa dibaca (Value, Text, Frame).")
    return nil 
end


-- [FIX 7] Fungsi baru untuk konsumsi item
local function ConsumeItem(itemName, humanoid)
    local itemTool = Player.Backpack:FindFirstChild(itemName)
    if not itemTool then return false end -- Gagal, tidak ada di backpack
    
    pcall(function()
        humanoid:EquipTool(itemTool)
        task.wait(0.7)
        local equippedItem = Player.Character:FindFirstChild(itemName)
        if equippedItem then
            EatFoodEvent:FireServer(equippedItem)
            task.wait(0.5) 
        end
    end)
    return true -- Berhasil
end

-- [FIX 7] Fungsi baru untuk beli item
local function BuyItem(itemName, price, amount)
    pcall(function()
        local buyArgs = {
            {
                [itemName] = { price = price, quantity = amount, name = itemName },
            }
        }
        CheckoutFunction:InvokeServer(unpack(buyArgs))
        CustomUI:Notify({Title = "Auto Eat/Drink", Content = "Membeli " .. amount .. " " .. itemName, Duration = 2})
        task.wait(2.5) -- Jeda agar item muncul di backpack
    end)
end

-- [FIX 7] Rombakan total loop Auto Eat/Drink
local function StartAutoEatLoop()
    task.spawn(function()
        while AutoEatEnabled do
            if IsEatingOrDrinking then task.wait(1); continue; end 

            local threshold = AutoEatThresholdSlider:Get()
            local amountToBuy = AutoEatAmountSlider:Get()
            
            local humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
            if not humanoid then task.wait(5); continue; end

            -- --- Cek Lapar (Hunger) ---
            local currentHunger = GetPlayerStatValue(HUNGER_PATH_STRING) -- [FIX 8] Menggunakan string
            
            if currentHunger and currentHunger < threshold then
                IsEatingOrDrinking = true
                humanoid:UnequipTools()
                task.wait(0.5)
                
                CustomUI:Notify({Title="Status", Content="Lapar terdeteksi ("..currentHunger.."), mencari Udon...", Duration=3})
                local consumed = ConsumeItem("Udon", humanoid)
                
                if not consumed then
                    BuyItem("Udon", 45000, amountToBuy)
                    ConsumeItem("Udon", humanoid) 
                end
                
                humanoid:UnequipTools()
                IsEatingOrDrinking = false
                task.wait(1) 
            end
            
            if not AutoEatEnabled then break end
            while IsEatingOrDrinking do task.wait(1) end 

            -- --- Cek Haus (Thirst) ---
            local currentThirst = GetPlayerStatValue(THIRST_PATH_STRING) -- [FIX 8] Menggunakan string
            
            if currentThirst and currentThirst < threshold then
                IsEatingOrDrinking = true
                humanoid:UnequipTools()
                task.wait(0.5)

                CustomUI:Notify({Title="Status", Content="Haus terdeteksi ("..currentThirst.."), mencari Air Mineral...", Duration=3})
                local consumed = ConsumeItem("Air Mineral", humanoid)
                
                if not consumed then
                    BuyItem("Air Mineral", 15000, amountToBuy)
                    ConsumeItem("Air Mineral", humanoid) 
                end
                
                humanoid:UnequipTools()
                IsEatingOrDrinking = false
                task.wait(1) 
            end

            -- --- Delay Cek Status ---
            local checkInterval = tonumber(AutoEatCheckIntervalTextbox:Get()) or 60
            local startTime = tick()
            while tick() - startTime < checkInterval do
                if not AutoEatEnabled then break end
                task.wait(1)
            end
        end
    end)
end

-- [UPDATE 9] Fungsi Teleport
local function TeleportPlayer(coords)
    local Character = Player.Character
    local HRP = Character and Character:FindFirstChild("HumanoidRootPart")
    
    if HRP then
        -- Menambahkan +5 pada Y untuk anti-stuck
        HRP.CFrame = CFrame.new(coords.x, coords.y + 5, coords.z)
        CustomUI:Notify({Title="Teleport", Content="Berhasil teleport!", Duration=3})
    else
        CustomUI:Notify({Title="Error", Content="Gagal teleport, karakter tidak ditemukan.", Duration=3})
    end
end

-- [UPDATE 9] Fungsi Anti-AFK
local function StartAntiAfkLoop()
    task.spawn(function()
        while AntiAfkEnabled do
            task.wait(60) -- Tunggu 60 detik
            
            if AntiAfkEnabled then -- Cek lagi kalau-kalau dimatikan saat menunggu
                local humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    pcall(function()
                        humanoid.Jump = true -- Buat lompat
                    end)
                end
            end
        end
    end)
end


--==============================================================================
-- PEMBUATAN TABS
--==============================================================================

-- [UPDATE 11] Rombakan Tab Auto Fish
local AutoFishTab = Window:CreateTab("Auto Fish")

AutoFishTab:CreateSection("ðŸŽ£ Pengaturan Pancingan")
AutoFishTab:CreateLabel("1. Klik Refresh, 2. Pilih Pancingan, 3. Aktifkan")

RodDropdown = AutoFishTab:CreateDropdown({
    Name = "Pilih Pancingan",
    Default = "Pilih Pancingan...",
    Options = {}
})

AutoFishTab:CreateButton({
    Name = "ðŸ”„ Refresh Daftar Pancingan",
    Callback = function()
        local rodNames = GetPlayerRodNames() -- [FIX 11] Memanggil fungsi baru
        RodDropdown:SetOptions(rodNames)
        CustomUI:Notify({Title="Refresh", Content="Daftar pancingan (Backpack & Dipegang) diperbarui!", Duration=3})
    end
})

AutoFishTab:CreateDivider()
AutoFishTab:CreateSection("âš¡ Kontrol & Kecepatan")

local AutoFishToggle = AutoFishTab:CreateToggle({
    Name = "Aktifkan Auto Fish (Pilihan)",
    CurrentValue = false,
    Callback = function(value)
        AutoFishEnabled = value
        if AutoFishEnabled then
            CustomUI:Notify({Title = "Auto Fish", Content = "Auto Fish Diaktifkan.", Duration = 3})
            StartMasterFishingLoop()
        else
            StopMasterFishingLoop()
            CustomUI:Notify({
                Title = "Auto Fish", 
                Content = "Auto Fish dihentikan.",
                Duration = 3
            })
        end
    end
})

InstantCatchToggle = AutoFishTab:CreateToggle({
    Name = "Mode Instan (Beresiko)",
    CurrentValue = false,
    Callback = function(value)
        if value then
            CustomUI:Notify({Title="Mode Instan", Content="Diaktifkan! Delay bypass akan diabaikan.", Duration=3})
        else
            CustomUI:Notify({Title="Mode Instan", Content="Nonaktif. Mode Stabil (Bypass) digunakan.", Duration=3})
        end
    end
})

BypassDelaySlider = AutoFishTab:CreateSlider({
    Name = "Delay Bypass (Mode Stabil)",
    Range = {0.1, 1.0},
    Increment = 0.1,
    CurrentValue = 0.2,
    Suffix = " detik",
})

CooldownPerRodSlider = AutoFishTab:CreateSlider({
    Name = "Cooldown Per Ikan (Anti-Lag)",
    Range = {0.1, 2.0},
    Increment = 0.1,
    CurrentValue = 0.5,
    Suffix = " detik",
})

AutoFishTab:CreateDivider()
AutoFishTab:CreateLabel("ðŸ’¡ Mode ini akan mengunci 1 pancingan yang Anda pilih.")
AutoFishTab:CreateLabel("Ini JAUH lebih cepat & anti ganti-ganti rod.")


-- =============================================================
-- TAB UTILITIES (UPDATE 9)
-- =============================================================
local UtilitiesTab = Window:CreateTab("Utilities")

-- --- Section Auto Eat/Drink ---
UtilitiesTab:CreateSection("ðŸ” Auto Eat / Drink (Cek Status)")
local AutoEatToggle = UtilitiesTab:CreateToggle({
    Name = "Aktifkan Auto Eat/Drink",
    CurrentValue = false,
    Callback = function(value)
        AutoEatEnabled = value
        if AutoEatEnabled then
            CustomUI:Notify({ Title = "Auto Eat/Drink", Content = "Auto Konsumsi (Cek Status) Diaktifkan.", Duration = 3 })
            StartAutoEatLoop()
        else
            IsEatingOrDrinking = false 
            CustomUI:Notify({ Title = "Auto Eat/Drink", Content = "Auto Konsumsi Dinonaktifkan.", Duration = 3 })
        end
    end
})

-- [FIX 7] Textbox baru
AutoEatCheckIntervalTextbox = UtilitiesTab:CreateTextbox({
    Name = "Interval Cek Status (detik)",
    Default = "60",
    Placeholder = "Contoh: 60",
    IsNumber = true
})

-- [FIX 7] Slider baru
AutoEatThresholdSlider = UtilitiesTab:CreateSlider({
    Name = "Makan/Minum jika di bawah",
    Range = {0, 100},
    Increment = 5,
    CurrentValue = 30,
    Suffix = "%"
})

AutoEatAmountSlider = UtilitiesTab:CreateSlider({
    Name = "Jumlah Beli (jika habis)",
    Range = {1, 10},
    Increment = 1,
    CurrentValue = 1,
    Suffix = "x"
})

UtilitiesTab:CreateDivider()
UtilitiesTab:CreateLabel("âš ï¸ PENTING: Pastikan path di `KONFIGURASI PLAYER`")
UtilitiesTab:CreateLabel("sudah diisi dengan benar agar fitur ini bekerja.")

-- [UPDATE 9] Section Anti-AFK
UtilitiesTab:CreateDivider()
UtilitiesTab:CreateSection("ðŸƒâ€â™‚ï¸ Anti-AFK")
UtilitiesTab:CreateToggle({
    Name = "Aktifkan Anti-AFK (Lompat)",
    CurrentValue = false,
    Callback = function(value)
        AntiAfkEnabled = value
        if AntiAfkEnabled then
            CustomUI:Notify({Title="Anti-AFK", Content="Diaktifkan! Akan lompat setiap 60 detik.", Duration=3})
            StartAntiAfkLoop()
        else
            CustomUI:Notify({Title="Anti-AFK", Content="Dinonaktifkan.", Duration=3})
        end
    end
})

-- [UPDATE 9] Section Teleport
UtilitiesTab:CreateDivider()
UtilitiesTab:CreateSection("ðŸš€ Teleport Lokasi")

UtilitiesTab:CreateButton({
    Name = "Jual Ikan",
    Callback = function() TeleportPlayer({x=2603.8, y=-355.0, z=-5407.5}) end
})

UtilitiesTab:CreateButton({
    Name = "Spot YGGDRASIL",
    Callback = function() TeleportPlayer({x=1505.8, y=-354.9, z=-5545.9}) end
})

UtilitiesTab:CreateButton({
    Name = "Toko Pancing",
    Callback = function() TeleportPlayer({x=2213.5, y=-348.7, z=-5594.6}) end
})

UtilitiesTab:CreateButton({
    Name = "Spot Event",
    Callback = function() TeleportPlayer({x=1883.5, y=-356.9, z=-4567.7}) end
})


-- Tab Settings
local SettingsTab = Window:CreateTab("Settings")
SettingsTab:CreateSection("ðŸŽ¨ Theme Settings")
SettingsTab:CreateLabel("Select your preferred theme:")
for _, themeName in ipairs({"Default", "Dark", "Light", "Purple"}) do
    SettingsTab:CreateButton({ Name = themeName .. " Theme", Callback = function() Window:ChangeTheme(themeName) end})
end
SettingsTab:CreateDivider()
SettingsTab:CreateSection("âŒ¨ï¸ Keybind Settings")
SettingsTab:CreateLabel("Set your preferred keybind for toggling UI:")
SettingsTab:CreateKeybind({ Name = "Toggle UI Keybind", CurrentKeybind = ToggleUIKeybind, Callback = function(key) Window:SetToggleKeybind(key) end})

-- Kembalikan tabel library
return CustomUI