-- DarkUI Library v4 (Animated by Gemini)
-- [UPDATE] Ditambahkan fitur Search untuk Dropdown
local DarkUI = {}

-- [[ Layanan dan Variabel Lokal ]]
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService") -- [[ UPDATE: Tambah TweenService ]]

-- [[ Tema & Warna ]]
local theme = {
	Accent = Color3.fromRGB(0, 255, 200),
	AccentDark = Color3.fromRGB(0, 180, 140),
	Background = Color3.fromRGB(20, 25, 30),
	Sidebar = Color3.fromRGB(25, 30, 35),
	Element = Color3.fromRGB(40, 45, 50),
	Text = Color3.fromRGB(240, 240, 240),
	TextSecondary = Color3.fromRGB(180, 180, 180),
	Red = Color3.fromRGB(255, 80, 80),
	
	Transparency = {
		Main = 0.15,
		Sidebar = 0.3,
		TopBar = 0.2,
		Element = 0.2
	}
}


function DarkUI:Load()
	local library = {}
	library.Config = {
		MainKeybind = Enum.KeyCode.RightControl
	}
	
	local tabs = {}
	local currentTab = nil
	local elementsYOffset = 0
	local isVisible = true

	-- Create main UI
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "DarkUILibrary_" .. math.random(1000, 9999)
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	ScreenGui.Parent = game:GetService("CoreGui")
	
	-- Tombol Buka/Logo
	local OpenButton = Instance.new("TextButton")
	OpenButton.Size = UDim2.new(0, 60, 0, 60)
	OpenButton.Position = UDim2.new(0, 30, 0.5, -30) -- Posisi awal
	OpenButton.BackgroundColor3 = theme.Accent
	OpenButton.Text = "MENU"
	OpenButton.Font = Enum.Font.GothamBold
	OpenButton.TextSize = 14
	OpenButton.TextColor3 = theme.Background
	OpenButton.Visible = false
	OpenButton.ZIndex = 10
	OpenButton.Parent = ScreenGui
	
	local OpenCorner = Instance.new("UICorner")
	OpenCorner.CornerRadius = UDim.new(0, 8)
	OpenCorner.Parent = OpenButton

	-- Main container
	local MainFrame = Instance.new("Frame")
	MainFrame.Size = UDim2.new(0, 600, 0, 400)
	-- [[ UPDATE: Ganti Posisi & AnchorPoint untuk Animasi Scale ]]
	MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0) -- Posisi tengah awal
	MainFrame.BackgroundColor3 = theme.Background
	MainFrame.BackgroundTransparency = theme.Transparency.Main
	MainFrame.BorderSizePixel = 0
	MainFrame.ClipsDescendants = true
	MainFrame.Parent = ScreenGui
	
	-- Tema Gradasi & Modern Cut
	local UICorner = Instance.new("UICorner")
	UICorner.CornerRadius = UDim.new(0, 12)
	UICorner.Parent = MainFrame
	
	local UIGradient = Instance.new("UIGradient")
	UIGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 35, 40)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 25, 30))
	})
	UIGradient.Rotation = 90
	UIGradient.Parent = MainFrame

	local UIStroke = Instance.new("UIStroke")
	UIStroke.Color = theme.Accent
	UIStroke.Transparency = 0.7
	UIStroke.Thickness = 1.5
	UIStroke.Parent = MainFrame

	-- Top bar
	local TopBar = Instance.new("Frame")
	TopBar.Size = UDim2.new(1, 0, 0, 40)
	TopBar.BackgroundColor3 = theme.Sidebar
	TopBar.BackgroundTransparency = theme.Transparency.TopBar
	TopBar.BorderSizePixel = 0
	TopBar.Parent = MainFrame
	
	local AccentLine = Instance.new("Frame")
	AccentLine.Size = UDim2.new(1, 0, 0, 1)
	AccentLine.Position = UDim2.new(0, 0, 1, -1)
	AccentLine.BackgroundColor3 = theme.Accent
	AccentLine.BackgroundTransparency = 0.5
	AccentLine.BorderSizePixel = 0
	AccentLine.Parent = TopBar
	
	local Title = Instance.new("TextLabel")
	Title.Size = UDim2.new(0, 200, 1, 0)
	Title.BackgroundTransparency = 1
	Title.Text = "DarkUI Library"
	Title.TextColor3 = theme.Accent
	Title.TextSize = 18
	Title.Font = Enum.Font.GothamBold
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Position = UDim2.new(0, 15, 0, 0)
	Title.Parent = TopBar
	
	-- Button Close
	local CloseButton = Instance.new("TextButton")
	CloseButton.Size = UDim2.new(0, 30, 0, 30)
	CloseButton.Position = UDim2.new(1, -35, 0.5, -15)
	CloseButton.BackgroundColor3 = theme.Red
	CloseButton.BackgroundTransparency = 0.1
	CloseButton.Text = "X"
	CloseButton.TextColor3 = theme.Text
	CloseButton.TextSize = 14
	CloseButton.Font = Enum.Font.GothamBold
	CloseButton.Parent = TopBar
	local CloseCorner = Instance.new("UICorner")
	CloseCorner.CornerRadius = UDim.new(0, 6)
	CloseCorner.Parent = CloseButton
	
	-- Button Minimize
	local MinimizeButton = Instance.new("TextButton")
	MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
	MinimizeButton.Position = UDim2.new(1, -70, 0.5, -15)
	MinimizeButton.BackgroundColor3 = theme.Element
	MinimizeButton.BackgroundTransparency = 0.1
	MinimizeButton.Text = "â€”"
	MinimizeButton.TextColor3 = theme.Text
	MinimizeButton.TextSize = 14
	MinimizeButton.Font = Enum.Font.GothamBold
	MinimizeButton.Parent = TopBar
	local MinCorner = Instance.new("UICorner")
	MinCorner.CornerRadius = UDim.new(0, 6)
	MinCorner.Parent = MinimizeButton

	-- Sidebar for tabs
	local SideBar = Instance.new("Frame")
	SideBar.Size = UDim2.new(0, 150, 1, -40)
	SideBar.Position = UDim2.new(0, 0, 0, 40)
	SideBar.BackgroundColor3 = theme.Sidebar
	SideBar.BackgroundTransparency = theme.Transparency.Sidebar
	SideBar.BorderSizePixel = 0
	SideBar.Parent = MainFrame
	
	-- Content area
	local ContentFrame = Instance.new("Frame")
	ContentFrame.Size = UDim2.new(1, -150, 1, -40)
	ContentFrame.Position = UDim2.new(0, 150, 0, 40)
	ContentFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
	ContentFrame.BackgroundTransparency = 1
	ContentFrame.BorderSizePixel = 0
	ContentFrame.Parent = MainFrame
	
	local ContentScrolling = Instance.new("ScrollingFrame")
	ContentScrolling.Size = UDim2.new(1, -20, 1, -20)
	ContentScrolling.Position = UDim2.new(0, 10, 0, 10)
	ContentScrolling.BackgroundTransparency = 1
	ContentScrolling.BorderSizePixel = 0
	ContentScrolling.ScrollBarThickness = 5
	ContentScrolling.ScrollBarImageColor3 = theme.Accent
	ContentScrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
	ContentScrolling.Parent = ContentFrame
	
	local ContentLayout = Instance.new("UIListLayout")
	ContentLayout.Padding = UDim.new(0, 10)
	ContentLayout.Parent = ContentScrolling
	
	-- Tab buttons container
	local TabButtonsFrame = Instance.new("Frame")
	TabButtonsFrame.Size = UDim2.new(1, 0, 1, -50)
	TabButtonsFrame.Position = UDim2.new(0, 0, 0, 0)
	TabButtonsFrame.BackgroundTransparency = 1
	TabButtonsFrame.Parent = SideBar
	
	local TabButtonsLayout = Instance.new("UIListLayout")
	TabButtonsLayout.Padding = UDim.new(0, 5)
	TabButtonsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	TabButtonsLayout.Parent = TabButtonsFrame
	
	-- Premium badge
	local PremiumBadge = Instance.new("TextLabel")
	PremiumBadge.Size = UDim2.new(1, -20, 0, 30)
	PremiumBadge.Position = UDim2.new(0, 10, 1, -40)
	PremiumBadge.BackgroundColor3 = theme.AccentDark
	PremiumBadge.Text = "PREMIUM"
	PremiumBadge.TextColor3 = theme.Background
	PremiumBadge.TextSize = 14
	PremiumBadge.Font = Enum.Font.GothamBold
	PremiumBadge.Parent = SideBar
	
	local PremiumCorner = Instance.new("UICorner")
	PremiumCorner.CornerRadius = UDim.new(0, 6)
	PremiumCorner.Parent = PremiumBadge
	
	
	-- [[ Fungsi Library ]]
	
	-- [[ UPDATE: Animasi Minimize/Maximize ]]
	local animInfo = TweenInfo.new(0.3, Enum.EasingStyle.Cubic, Enum.EasingDirection.Out)
	local originalSize = UDim2.new(0, 600, 0, 400)
	local minimizedSize = UDim2.new(0, 0, 0, 0)

	function library:ToggleVisibility()
		isVisible = not isVisible
		
		if isVisible then -- Maximizing (Membuka)
			OpenButton.Visible = false
			MainFrame.Visible = true
			MainFrame.Size = minimizedSize -- Mulai dari kecil
			
			local tweenMaximize = TweenService:Create(MainFrame, animInfo, {Size = originalSize})
			tweenMaximize:Play()
		else -- Minimizing (Menutup)
			-- Pindahkan OpenButton ke posisi MainFrame saat ini sebelum mengecil
			-- Ini membuat logo muncul di tempat UI menghilang
			local currentPos = MainFrame.Position
			OpenButton.Position = UDim2.new(currentPos.X.Scale, currentPos.X.Offset - (OpenButton.AbsoluteSize.X / 2), currentPos.Y.Scale, currentPos.Y.Offset - (OpenButton.AbsoluteSize.Y / 2))
			OpenButton.Visible = true
			
			local tweenMinimize = TweenService:Create(MainFrame, animInfo, {Size = minimizedSize})
			tweenMinimize:Play()
			
			-- Sembunyikan frame UTAMA setelah animasi selesai
			tweenMinimize.Completed:Connect(function()
				if not isVisible then 
					MainFrame.Visible = false
				end
			end)
		end
	end
	
	function library:Destroy()
		ScreenGui:Destroy()
	end
	
	CloseButton.MouseButton1Click:Connect(library.Destroy)
	MinimizeButton.MouseButton1Click:Connect(library.ToggleVisibility)
	OpenButton.MouseButton1Click:Connect(library.ToggleVisibility)

	-- Sistem Key (Keybind)
	UIS.InputBegan:Connect(function(input, gameProcessed)
		if gameProcessed then return end
		
		if input.KeyCode == library.Config.MainKeybind then
			library:ToggleVisibility()
		end
	end)
	
	-- Draggable MainFrame
	local dragging = false
	local dragInput
	local dragStart
	local startPos
	
	TopBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = MainFrame.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	TopBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			if dragging then
				local delta = input.Position - dragStart
				-- Karena AnchorPoint 0.5, 0.5, kita tidak perlu mengubah logika drag
				MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
			end
		end
	end)

	-- [[ UPDATE: Draggable Logo ]]
	local logoDragging = false
	local logoDragStart
	local logoStartPos

	OpenButton.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			logoDragging = true
			logoDragStart = input.Position
			logoStartPos = OpenButton.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					logoDragging = false
				end
			end)
		end
	end)

	OpenButton.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			if logoDragging then
				local delta = input.Position - logoDragStart
				OpenButton.Position = UDim2.new(logoStartPos.X.Scale, logoStartPos.X.Offset + delta.X, logoStartPos.Y.Scale, logoStartPos.Y.Offset + delta.Y)
			end
		end
	end)

	
	function library:MakeWindow(config)
		Title.Text = config.Name or "DarkUI Library"
		return library
	end
	
	function library:MakeTab(tabConfig)
		local tab = {}
		local tabElements = {}
		local tabButton
		
		-- Create tab button
		tabButton = Instance.new("TextButton")
		tabButton.Size = UDim2.new(1, -20, 0, 35)
		tabButton.Position = UDim2.new(0, 10, 0, #tabs * 40)
		tabButton.BackgroundColor3 = theme.Element
		tabButton.BackgroundTransparency = theme.Transparency.Element
		tabButton.Text = tabConfig.Name
		tabButton.TextColor3 = theme.Text
		tabButton.TextSize = 14
		tabButton.Font = Enum.Font.Gotham
		tabButton.LayoutOrder = tabConfig.Order or #tabs
		tabButton.Parent = TabButtonsFrame
		
		local tabCorner = Instance.new("UICorner")
		tabCorner.CornerRadius = UDim.new(0, 6)
		tabCorner.Parent = tabButton
		
		-- Tab content
		local tabContent = Instance.new("Frame")
		tabContent.Size = UDim2.new(1, 0, 0, 0)
		tabContent.BackgroundTransparency = 1
		tabContent.Visible = false
		tabContent.Parent = ContentScrolling
		
		local tabContentLayout = Instance.new("UIListLayout")
		tabContentLayout.Padding = UDim.new(0, 10)
		tabContentLayout.Parent = tabContent
		
		-- Select first tab
		if #tabs == 0 then
			tabButton.BackgroundColor3 = theme.Accent
			tabButton.BackgroundTransparency = 0
			tabContent.Visible = true
			currentTab = tabContent
		end
		
		tabButton.MouseButton1Click:Connect(function()
			for _, existingTab in pairs(tabs) do
				existingTab.content.Visible = false
				existingTab.button.BackgroundColor3 = theme.Element
				existingTab.button.BackgroundTransparency = theme.Transparency.Element
			end
			
			tabContent.Visible = true
			tabButton.BackgroundColor3 = theme.Accent
			tabButton.BackgroundTransparency = 0
			currentTab = tabContent
		end)
		
		-- Fungsi untuk update canvas size
		local function UpdateCanvasSize()
			RunService.Heartbeat:Wait() 
			local contentHeight = tabContentLayout.AbsoluteContentSize.Y
			tabContent.Size = UDim2.new(1, 0, 0, contentHeight)
			
			local mainContentHeight = ContentLayout.AbsoluteContentSize.Y
			ContentScrolling.CanvasSize = UDim2.new(0, 0, 0, mainContentHeight + 20)
		end
		
		-- [[ Element Functions ]]
		
		function tab:AddButton(buttonConfig)
			local buttonElement = Instance.new("TextButton")
			buttonElement.Size = UDim2.new(1, 0, 0, 35)
			buttonElement.BackgroundColor3 = theme.Element
			buttonElement.BackgroundTransparency = theme.Transparency.Element
			buttonElement.Text = buttonConfig.Name
			buttonElement.TextColor3 = theme.Text
			buttonElement.TextSize = 14
			buttonElement.Font = Enum.Font.Gotham
			buttonElement.Parent = tabContent
			
			local buttonCorner = Instance.new("UICorner")
			buttonCorner.CornerRadius = UDim.new(0, 6)
			buttonCorner.Parent = buttonElement
			
			buttonElement.MouseButton1Click:Connect(buttonConfig.Callback)
			
			UpdateCanvasSize()
			return buttonElement
		end
		
		function tab:AddToggle(toggleConfig)
			local toggleFrame = Instance.new("Frame")
			toggleFrame.Size = UDim2.new(1, 0, 0, 35)
			toggleFrame.BackgroundTransparency = 1
			toggleFrame.Parent = tabContent
			
			local toggleLabel = Instance.new("TextLabel")
			toggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
			toggleLabel.BackgroundTransparency = 1
			toggleLabel.Text = toggleConfig.Name
			toggleLabel.TextColor3 = theme.Text
			toggleLabel.TextSize = 14
			toggleLabel.Font = Enum.Font.Gotham
			toggleLabel.TextXAlignment = Enum.TextXAlignment.Left
			toggleLabel.Parent = toggleFrame
			
			local toggleButton = Instance.new("TextButton")
			toggleButton.Size = UDim2.new(0, 50, 0, 25)
			toggleButton.Position = UDim2.new(1, -55, 0.5, -12.5)
			toggleButton.Text = ""
			toggleButton.Parent = toggleFrame
			
			local toggleCorner = Instance.new("UICorner")
			toggleCorner.CornerRadius = UDim.new(0, 12)
			toggleCorner.Parent = toggleButton
			
			local toggleState = toggleConfig.Default or false
			
			-- [PERBAIKAN] Tambahkan fungsi Set() untuk LoadConfig
			local toggleObject = {}
			
			local function updateToggle(fireCallback)
				if toggleState then
					toggleButton.BackgroundColor3 = theme.Accent
					toggleButton.BackgroundTransparency = 0
				else
					toggleButton.BackgroundColor3 = theme.Element
					toggleButton.BackgroundTransparency = theme.Transparency.Element
				end
				if fireCallback and toggleConfig.Callback then
					toggleConfig.Callback(toggleState)
				end
			end
			
			toggleButton.MouseButton1Click:Connect(function()
				toggleState = not toggleState
				updateToggle(true)
			end)
			
			function toggleObject:Set(value)
				toggleState = value
				updateToggle(false) -- Update visual tanpa memicu callback
			end
			
			updateToggle(false) -- Panggil saat inisialisasi
			UpdateCanvasSize()
			
			return toggleObject -- Kembalikan objek, bukan frame
		end
		
		function tab:AddLabel(labelConfig)
			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, 0, 0, 30)
			label.BackgroundTransparency = 1
			label.Text = labelConfig.Name
			label.TextColor3 = theme.Text
			label.TextSize = 16
			label.Font = Enum.Font.GothamBold
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = tabContent
			
			UpdateCanvasSize()
			return label
		end
		
		function tab:AddParagraph(paragraphConfig)
			local paragraphFrame = Instance.new("Frame")
			paragraphFrame.Size = UDim2.new(1, 0, 0, 100)
			paragraphFrame.BackgroundTransparency = 1
			paragraphFrame.AutomaticSize = Enum.AutomaticSize.Y
			paragraphFrame.Parent = tabContent
			
			local title = Instance.new("TextLabel")
			title.Size = UDim2.new(1, 0, 0, 20)
			title.BackgroundTransparency = 1
			title.Text = paragraphConfig.Name or "Paragraph"
			title.TextColor3 = theme.Text
			title.TextSize = 16
			title.Font = Enum.Font.GothamBold
			title.TextXAlignment = Enum.TextXAlignment.Left
			title.Parent = paragraphFrame -- [PERBAIKAN] Bug: sebelumnya .Parent = title
			
			local content = Instance.new("TextLabel")
			content.Size = UDim2.new(1, 0, 0, 0)
			content.Position = UDim2.new(0, 0, 0, 25)
			content.BackgroundTransparency = 1
			content.Text = paragraphConfig.Content or ""
			content.TextColor3 = theme.TextSecondary
			content.TextSize = 12
			content.Font = Enum.Font.Gotham
			content.TextXAlignment = Enum.TextXAlignment.Left
			content.TextYAlignment = Enum.TextYAlignment.Top
			content.TextWrapped = true
			content.AutomaticSize = Enum.AutomaticSize.Y
			content.Parent = paragraphFrame
			
			UpdateCanvasSize()
			return paragraphFrame
		end
		
		function tab:AddSlider(sliderConfig)
			local min = sliderConfig.Min or 0
			local max = sliderConfig.Max or 100
			local default = sliderConfig.Default or min
			local callback = sliderConfig.Callback or function() end

			local sliderFrame = Instance.new("Frame")
			sliderFrame.Size = UDim2.new(1, 0, 0, 60)
			sliderFrame.BackgroundTransparency = 1
			sliderFrame.Parent = tabContent

			local sliderLabel = Instance.new("TextLabel")
			sliderLabel.Size = UDim2.new(0.7, 0, 0, 20)
			sliderLabel.BackgroundTransparency = 1
			sliderLabel.Text = sliderConfig.Name or "Slider"
			sliderLabel.TextColor3 = theme.Text
			sliderLabel.TextSize = 14
			sliderLabel.Font = Enum.Font.Gotham
			sliderLabel.TextXAlignment = Enum.TextXAlignment.Left
			sliderLabel.Parent = sliderFrame
			
			local valueLabel = Instance.new("TextLabel")
			valueLabel.Size = UDim2.new(0.3, 0, 0, 20)
			valueLabel.Position = UDim2.new(0.7, 0, 0, 0)
			valueLabel.BackgroundTransparency = 1
			valueLabel.TextColor3 = theme.TextSecondary
			valueLabel.TextSize = 14
			valueLabel.Font = Enum.Font.Gotham
			valueLabel.TextXAlignment = Enum.TextXAlignment.Right
			valueLabel.Parent = sliderFrame

			local sliderBack = Instance.new("Frame")
			sliderBack.Size = UDim2.new(1, 0, 0, 10)
			sliderBack.Position = UDim2.new(0, 0, 0, 35)
			sliderBack.BackgroundColor3 = theme.Element
			sliderBack.BackgroundTransparency = theme.Transparency.Element
			sliderBack.Parent = sliderFrame
			local backCorner = Instance.new("UICorner")
			backCorner.CornerRadius = UDim.new(0, 5)
			backCorner.Parent = sliderBack
			
			local sliderFill = Instance.new("Frame")
			sliderFill.Size = UDim2.new(0, 0, 1, 0)
			sliderFill.BackgroundColor3 = theme.Accent
			sliderFill.Parent = sliderBack
			local fillCorner = Instance.new("UICorner")
			fillCorner.CornerRadius = UDim.new(0, 5)
			fillCorner.Parent = sliderFill
			
			local handle = Instance.new("TextButton")
			handle.Size = UDim2.new(0, 20, 0, 20)
			handle.Position = UDim2.new(0, -10, 0.5, -10)
			handle.BackgroundColor3 = theme.AccentDark
			handle.Text = ""
			handle.ZIndex = 2
			handle.Parent = sliderBack
			local handleCorner = Instance.new("UICorner")
			handleCorner.CornerRadius = UDim.new(1, 0)
			handleCorner.Parent = handle

			local currentValue = default
			local sliderObject = {}
			
			local function UpdateSlider(value, fireCallback)
				currentValue = math.clamp(value, min, max)
				local percent = (currentValue - min) / (max - min)
				
				valueLabel.Text = string.format("%.1f", currentValue)
				sliderFill.Size = UDim2.new(percent, 0, 1, 0)
				handle.Position = UDim2.new(percent, 0, 0.5, -10)
				
				if fireCallback and callback then
					callback(currentValue)
				end
			end
			
			function sliderObject:Set(value)
				UpdateSlider(value, false)
			end
			
			local dragging = false
			local dragConn = nil
			local inputEndedConn = nil

			handle.InputBegan:Connect(function(input)
				if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and not dragging then
					dragging = true
					handle.BackgroundColor3 = theme.Accent
					
					if dragConn then dragConn:Disconnect() end
					dragConn = RunService.RenderStepped:Connect(function()
						local mouseX = UIS:GetMouseLocation().X
						if input.UserInputType == Enum.UserInputType.Touch then
							local touchPos = UIS:GetTouchPositions()
							if #touchPos > 0 then mouseX = touchPos[1].X end
						end

						local frameX = sliderBack.AbsolutePosition.X
						local frameWidth = sliderBack.AbsoluteSize.X
						
						local percent = math.clamp((mouseX - frameX) / frameWidth, 0, 1)
						local newValue = min + (max - min) * percent
						UpdateSlider(newValue, true)
					end)
					
					if inputEndedConn then inputEndedConn:Disconnect() end
					inputEndedConn = UIS.InputEnded:Connect(function(endInput)
						if endInput.UserInputType == Enum.UserInputType.MouseButton1 or endInput.UserInputType == Enum.UserInputType.Touch then
							dragging = false
							handle.BackgroundColor3 = theme.AccentDark
							if dragConn then dragConn:Disconnect(); dragConn = nil end
							if inputEndedConn then inputEndedConn:Disconnect(); inputEndedConn = nil end
						end
					end)
				end
			end)
			
			UpdateSlider(default, false)
			UpdateCanvasSize()
			return sliderObject -- Kembalikan objek, bukan frame
		end

		function tab:AddTextBox(textboxConfig)
			local textboxFrame = Instance.new("Frame")
			textboxFrame.Size = UDim2.new(1, 0, 0, 60)
			textboxFrame.BackgroundTransparency = 1
			textboxFrame.Parent = tabContent

			local textboxLabel = Instance.new("TextLabel")
			textboxLabel.Size = UDim2.new(1, 0, 0, 20)
			textboxLabel.BackgroundTransparency = 1
			textboxLabel.Text = textboxConfig.Name or "TextBox"
			textboxLabel.TextColor3 = theme.Text
			textboxLabel.TextSize = 14
			textboxLabel.Font = Enum.Font.Gotham
			textboxLabel.TextXAlignment = Enum.TextXAlignment.Left
			textboxLabel.Parent = textboxFrame
			
			local textboxBg = Instance.new("Frame")
			textboxBg.Size = UDim2.new(1, 0, 0, 35)
			textboxBg.Position = UDim2.new(0, 0, 0, 25)
			textboxBg.BackgroundColor3 = theme.Element
			textboxBg.BackgroundTransparency = theme.Transparency.Element
			textboxBg.Parent = textboxFrame
			local bgCorner = Instance.new("UICorner")
			bgCorner.CornerRadius = UDim.new(0, 6)
			bgCorner.Parent = textboxBg
			
			local textBox = Instance.new("TextBox")
			textBox.Size = UDim2.new(1, -20, 1, -10)
			textBox.Position = UDim2.new(0, 10, 0, 5)
			textBox.BackgroundTransparency = 1
			textBox.Text = textboxConfig.Default or ""
			textBox.PlaceholderText = textboxConfig.Placeholder or "..."
			textBox.TextColor3 = theme.Text
			textBox.PlaceholderColor3 = theme.TextSecondary
			textBox.TextSize = 14
			textBox.Font = Enum.Font.Gotham
			textBox.ClearTextOnFocus = false
			textBox.Parent = textboxBg
			
			local textboxObject = {}
			
			textBox.FocusLost:Connect(function(enterPressed)
				if textboxConfig.Callback then
					textboxConfig.Callback(textBox.Text)
				end
			end)
			
			function textboxObject:Set(value)
				textBox.Text = value
			end
			
			UpdateCanvasSize()
			return textboxObject -- Kembalikan objek, bukan frame
		end

		function tab:AddDropdown(dropdownConfig)
			local options = dropdownConfig.Options or {}
			local callback = dropdownConfig.Callback or function() end
			local dropdownObject = {}
			
			local dropdownFrame = Instance.new("Frame")
			dropdownFrame.Size = UDim2.new(1, 0, 0, 60)
			dropdownFrame.BackgroundTransparency = 1
			dropdownFrame.ZIndex = 2
			dropdownFrame.Parent = tabContent

			local dropdownLabel = Instance.new("TextLabel")
			dropdownLabel.Size = UDim2.new(1, 0, 0, 20)
			dropdownLabel.BackgroundTransparency = 1
			dropdownLabel.Text = dropdownConfig.Name or "Dropdown"
			dropdownLabel.TextColor3 = theme.Text
			dropdownLabel.TextSize = 14
			dropdownLabel.Font = Enum.Font.Gotham
			dropdownLabel.TextXAlignment = Enum.TextXAlignment.Left
			dropdownLabel.Parent = dropdownFrame
			
			local mainButton = Instance.new("TextButton")
			mainButton.Size = UDim2.new(1, 0, 0, 35)
			mainButton.Position = UDim2.new(0, 0, 0, 25)
			mainButton.BackgroundColor3 = theme.Element
			mainButton.BackgroundTransparency = theme.Transparency.Element
			mainButton.Text = dropdownConfig.Default or options[1] or "Select..."
			mainButton.TextColor3 = theme.Text
			mainButton.TextSize = 14
			mainButton.Font = Enum.Font.Gotham
			mainButton.Parent = dropdownFrame
			local mainCorner = Instance.new("UICorner")
			mainCorner.CornerRadius = UDim.new(0, 6)
			mainCorner.Parent = mainButton
			
			local optionsList = Instance.new("ScrollingFrame")
			optionsList.Size = UDim2.new(1, 0, 0, 155) -- [PERBAIKAN] Tambah tinggi untuk search box
			optionsList.Position = UDim2.new(0, 0, 0, 65)
			optionsList.BackgroundColor3 = theme.Element
			optionsList.BorderSizePixel = 0
			optionsList.Visible = false
			optionsList.ZIndex = 3
			optionsList.ScrollBarThickness = 4
			optionsList.ScrollBarImageColor3 = theme.Accent
			optionsList.AutomaticCanvasSize = Enum.AutomaticSize.Y -- [PERBAIKAN] Buat canvas otomatis
			optionsList.Parent = dropdownFrame
			local listCorner = Instance.new("UICorner")
			listCorner.CornerRadius = UDim.new(0, 6)
			listCorner.Parent = optionsList
			local listLayout = Instance.new("UIListLayout")
			listLayout.Padding = UDim.new(0, 2)
			listLayout.SortOrder = Enum.SortOrder.LayoutOrder -- [PERBAIKAN] Gunakan LayoutOrder
			listLayout.Parent = optionsList
			
			-- [[ FITUR BARU: SEARCH BOX ]]
			local searchBox = Instance.new("TextBox")
			searchBox.Name = "SearchBox"
			searchBox.Size = UDim2.new(1, -10, 0, 30)
			searchBox.Position = UDim2.new(0.5, 0, 0, 0)
			searchBox.AnchorPoint = Vector2.new(0.5, 0)
			searchBox.BackgroundColor3 = theme.Background -- Lebih gelap
			searchBox.TextColor3 = theme.Text
			searchBox.PlaceholderText = "Cari..."
			searchBox.PlaceholderColor3 = theme.TextSecondary
			searchBox.Font = Enum.Font.Gotham
			searchBox.TextSize = 12
			searchBox.ClearTextOnFocus = false
			searchBox.ZIndex = 4
			searchBox.LayoutOrder = 1 -- Muncul pertama
			searchBox.Parent = optionsList
			local searchCorner = Instance.new("UICorner")
			searchCorner.CornerRadius = UDim.new(0, 4)
			searchCorner.Parent = searchBox
			
			-- Padding di bawah search box
			local searchPadding = Instance.new("Frame")
			searchPadding.Size = UDim2.new(1, 0, 0, 5)
			searchPadding.BackgroundTransparency = 1
			searchPadding.LayoutOrder = 2
			searchPadding.Parent = optionsList
			-- [[ AKHIR FITUR BARU ]]

			local allOptionButtons = {} -- Simpan semua tombol untuk filtering
			
			mainButton.MouseButton1Click:Connect(function()
				optionsList.Visible = not optionsList.Visible
				if optionsList.Visible then
					dropdownFrame.Size = UDim2.new(1, 0, 0, 60 + optionsList.Size.Y.Offset + 5)
				else
					dropdownFrame.Size = UDim2.new(1, 0, 0, 60)
					searchBox.Text = "" -- Reset search saat ditutup
				end
				UpdateCanvasSize()
			end)
			
			for _, optionName in ipairs(options) do
				local optionButton = Instance.new("TextButton")
				optionButton.Size = UDim2.new(1, 0, 0, 30)
				optionButton.BackgroundColor3 = theme.Element
				optionButton.BackgroundTransparency = 1
				optionButton.Text = optionName
				optionButton.TextColor3 = theme.TextSecondary
				optionButton.TextSize = 14
				optionButton.Font = Enum.Font.Gotham
				optionButton.LayoutOrder = 3 -- Muncul setelah search & padding
				optionButton.Parent = optionsList
				
				table.insert(allOptionButtons, optionButton) -- Tambahkan ke list
				
				optionButton.MouseButton1Click:Connect(function()
					mainButton.Text = optionName
					optionsList.Visible = false
					dropdownFrame.Size = UDim2.new(1, 0, 0, 60)
					searchBox.Text = "" -- Reset search saat memilih
					callback(optionName)
					UpdateCanvasSize()
				end)
				
				optionButton.MouseEnter:Connect(function() optionButton.TextColor3 = theme.Text end)
				optionButton.MouseLeave:Connect(function() optionButton.TextColor3 = theme.TextSecondary end)
			end
			
			-- [[ FITUR BARU: LOGIC SEARCH ]]
			searchBox:GetPropertyChangedSignal("Text"):Connect(function()
				local searchText = string.lower(searchBox.Text)
				
				if searchText == "" then
					for _, button in ipairs(allOptionButtons) do
						button.Visible = true
					end
					return
				end
				
				for _, button in ipairs(allOptionButtons) do
					local buttonText = string.lower(button.Text)
					if string.find(buttonText, searchText, 1, true) then
						button.Visible = true
					else
						button.Visible = false
					end
				end
			end)
			
			-- [PERBAIKAN] Tambahkan fungsi SetOptions
			function dropdownObject:SetOptions(newOptions)
				-- Hapus opsi lama
				for _, button in ipairs(allOptionButtons) do
					button:Destroy()
				end
				allOptionButtons = {}
				
				-- Tambah opsi baru
				for _, optionName in ipairs(newOptions) do
					local optionButton = Instance.new("TextButton")
					optionButton.Size = UDim2.new(1, 0, 0, 30)
					optionButton.BackgroundColor3 = theme.Element
					optionButton.BackgroundTransparency = 1
					optionButton.Text = optionName
					optionButton.TextColor3 = theme.TextSecondary
					optionButton.TextSize = 14
					optionButton.Font = Enum.Font.Gotham
					optionButton.LayoutOrder = 3
					optionButton.Parent = optionsList
					
					table.insert(allOptionButtons, optionButton)
					
					optionButton.MouseButton1Click:Connect(function()
						mainButton.Text = optionName
						optionsList.Visible = false
						dropdownFrame.Size = UDim2.new(1, 0, 0, 60)
						searchBox.Text = ""
						callback(optionName)
						UpdateCanvasSize()
					end)
					
					optionButton.MouseEnter:Connect(function() optionButton.TextColor3 = theme.Text end)
					optionButton.MouseLeave:Connect(function() optionButton.TextColor3 = theme.TextSecondary end)
				end
				-- Reset filter
				searchBox.Text = ""
			end
			
			UpdateCanvasSize()
			return dropdownObject
		end
		
		function tab:AddKeybind(keybindConfig)
			local keybindFrame = Instance.new("Frame")
			keybindFrame.Size = UDim2.new(1, 0, 0, 35)
			keybindFrame.BackgroundTransparency = 1
			keybindFrame.Parent = tabContent
			
			local keybindLabel = Instance.new("TextLabel")
			keybindLabel.Size = UDim2.new(0.6, 0, 1, 0)
			keybindLabel.BackgroundTransparency = 1
			keybindLabel.Text = keybindConfig.Name
			keybindLabel.TextColor3 = theme.Text
			keybindLabel.TextSize = 14
			keybindLabel.Font = Enum.Font.Gotham
			keybindLabel.TextXAlignment = Enum.TextXAlignment.Left
			keybindLabel.Parent = keybindFrame
			
			local keybindButton = Instance.new("TextButton")
			keybindButton.Size = UDim2.new(0.4, -10, 1, 0)
			keybindButton.Position = UDim2.new(0.6, 0, 0, 0)
			keybindButton.BackgroundColor3 = theme.Element
			keybindButton.BackgroundTransparency = theme.Transparency.Element
			keybindButton.TextColor3 = theme.Text
			keybindButton.TextSize = 14
			keybindButton.Font = Enum.Font.Gotham
			keybindButton.Parent = keybindFrame
			
			local keybindCorner = Instance.new("UICorner")
			keybindCorner.CornerRadius = UDim.new(0, 6)
			keybindCorner.Parent = keybindButton
			
			local isBinding = false
			local currentKey = keybindConfig.Default -- [PERBAIKAN] Simpan key saat ini
			keybindButton.Text = currentKey.Name
			
			local inputConn
			
			-- [PERBAIKAN] Batalkan binding jika fokus hilang
			keybindButton.FocusLost:Connect(function()
				if isBinding then
					isBinding = false
					keybindButton.Text = currentKey.Name
					if inputConn then
						inputConn:Disconnect()
					end
				end
			end)
			
			keybindButton.MouseButton1Click:Connect(function()
				if isBinding then return end
				isBinding = true
				keybindButton.Text = "..."
				
				if inputConn then inputConn:Disconnect() end -- Pastikan koneksi lama mati
				
				inputConn = UIS.InputBegan:Connect(function(input, gpe)
					if gpe then return end
					if input.UserInputType == Enum.UserInputType.Keyboard then
						local newKey = input.KeyCode
						currentKey = newKey -- [PERBAIKAN] Update key
						keybindButton.Text = newKey.Name
						if keybindConfig.Callback then
							keybindConfig.Callback(newKey)
						end
						
						isBinding = false
						inputConn:Disconnect()
					end
				end)
			end)
			
			UpdateCanvasSize()
			return keybindFrame
		end
		
		
		-- Store tab data
		table.insert(tabs, {
			button = tabButton,
			content = tabContent,
			elements = tabElements
		})
		
		-- Update tab buttons layout
		TabButtonsFrame.Size = UDim2.new(1, 0, 0, (#tabs * 40) + 10)
		
		return tab
	end
	
	function library:Init()
		print("DarkUI Library Initialized!")
		return library
	end
	
	return library
end

return DarkUI
